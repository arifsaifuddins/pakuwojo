<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="http://localhost:3002/public/images/poster-1653521334535-349382777-8526754.png"
    type="image/png">
  <title>TEST</title>
</head>

<body>
  <input type="url" class="download"><br>
  <button class="download">download</button>

  <br><br><br>

  <input type="text" class="name"><br>
  <input type="text" class="price"><br>
  <input type="file" class="poster"><br>
  <button class="add">submit</button>
  <button class="show">show</button>
  <button class="delete">delete</button><br>
  <img alt="gambar" class="img" width="200">
  <p class="p"></p>

  <script>
    const nama = document.querySelector('.name')
    const price = document.querySelector('.price')
    const poster = document.querySelector('.poster')
    const img = document.querySelector('.img')
    const add = document.querySelector('.add')
    const show = document.querySelector('.show')
    const p = document.querySelector('.p')
    const del = document.querySelector('.delete')

    poster.addEventListener('input', (e) => {
      return img.src = URL.createObjectURL(e.target.files[0])
    })

    show.addEventListener('click', async () => {
      await fetch('http://localhost:3002/api/menu/foods', {
        method: 'GET',
        headers: {
          'auth': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjkxYjEwNjcyY2MyN2FjMWVmZTY1YjMiLCJpYXQiOjE2NTM3Mjc5NzF9._jo_mNj5o73w-B61OHHUasJg9bwLA4THHCfiZ9dkmmc'
        }
      }).then(re => re.json()).then(res => {
        data = res.data
        data.forEach(a => {
          p.textContent += a.updatedAt
        })
      })
    })

    add.addEventListener('click', async function () {
      const data = new FormData()
      data.append('name', nama.value)
      data.append('price', price.value)
      data.append('poster', poster.files[0])

      await fetch('http://localhost:3002/api/menu/foods', {
        method: 'POST',
        headers: {
          'auth': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjkxYjEwNjcyY2MyN2FjMWVmZTY1YjMiLCJpYXQiOjE2NTM3Mjc5NzF9._jo_mNj5o73w-B61OHHUasJg9bwLA4THHCfiZ9dkmmc'
        },
        body: data
      }).then(re => re.json()).then(res => console.log(res))
    })

    del.addEventListener('click', async () => {
      await fetch('http://localhost:3002/api/menu/foods', {
        method: 'DELETE'
      }).then(re => re.json()).then(res => console.log(res))
    })


    const input = document.querySelector('input.download')
    const btn = document.querySelector('button.download')

    btn.addEventListener('click', () => {
      const url = input.value

      if (!url) {
        input.value = 'yang bener!'
        input.style.color = 'red'
        return false
      }

      fetch(url)
        .then(res => res.blob())
        .then(urlDownload => {
          let a = document.createElement('a')

          a.href = URL.createObjectURL(urlDownload)
          a.download = Math.random() * 100000
          document.body.appendChild(a)

          a.click()
          a.remove()
        })
    })
  </script>
</body>

</html>